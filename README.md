# README
This is the official repo for the paper "Pretrained Battery Transformer (PBT): A battery life prediction foundation model". This work presents the first widely transferable foundation model for early prediction of battery lifetime. It features the following utility:
1. One model for diverse aging conditions: PBT is pretrained using 13 diverse lithium-ion battery (LIB) datasets. Through transfer learning, PBT adapts easily to predict the cycle life of batteries outside its pretraining distribution. PBT is validated on the largest and most diverse public battery life database available to date. It covers:
- Almost all commercial Lithium-ion battery (LIB) chemistries.
- Various formation, charge, and discharge protocols.
- Diverse operation temperatures and stress factors.
- Chemistries beyond LIBs (e.g., Zn-ion and Na-ion batteries).
2. One model for a wide spectrum of early prediction settings: Unlike models requiring a fixed input length, PBT can predict cycle life using an arbitrary number of first N cycles (where N is any integer $\le$ 100).
3. Leading model performance: PBT achieves state-of-the-art performance on the 15 datasets, often outperforming existing methods by a significant margin.

ðŸ™‹ Please let us know if you find a mistake or have any suggestions!
ðŸŒŸ If you find this resource helpful, we would appreciate citations to our research and stars to this repo.

## Dependencies
Run the following command to install the dependencies:

(This is generated by pipreqs tool)
```
pip install -r requirements.txt
```

## Data preparation
Please directly download the newest processed datasets from [BatteryLife project](https://github.com/Ruifeng-Tan/BatteryLife), and move them to a folder named "dataset".

## Pretrained checkpoints
We have provided the pretrained parameters reported in the paper. Please download them from [Zenodo](https://zenodo.org/records/17972780).

## Generate the LLM-based embeddings for aging conditions
You can skip this step by directly downloading the pre-generated embeddings from [Zenodo](https://zenodo.org/records/17972780). If you want to generate the embeddings by yourself, please run the following command:
```
python download_LLM_from_hf # download LLM from huggingface
```
Then, you should run all cells in the `generate_aging_condition_pretraining.ipynb` to generate the embeddings.

## Pretrain the PBT model
Please run the following command to train the PBT model:
```
sh scripts/PBT.sh
# Note that you can tune the hyperparameters (e.g., learning_rate, e_layers, and d_layers) in the script.
```

## Transfer PBT for a specific dataset
After pretraining, PBT has mastered comprehensive and transferable representations for a wide spectrum of cycle life prediction applications. You can transfer PBT to any battery life dataset.
```
sh scripts/finetune_PBT.sh
# Please set 'finetune_dataset' as the target dataset you want to transfer PBT to.
# Note that you can tune the hyperparameters (e.g., learning_rate, batch_size) in the script.
# We have supported two kinds of transfer learning strategies:
# 1. Full fine-tuning (set 'finetune_method' as FT): fine-tune the entire model on the target dataset.
# 2. Adapter tuning (set 'finetune_method' as AT or AT_nCP): insert and fine-tune only the adapter parameters on the target dataset.
```

## Evaluate the trained model
Please run the following command to evaluate the trained model:
```
sh scripts/evaluate_model.sh
# You can examine the model performance on arbitrary datasets by modifying the "eval_dataset" script,
# but note that the eval_dataset is fixed to the transferred dataset if the evaluated trained parameters
# are produced by transfer learning.
```

## Acknowledgement
This repo is constructed based on the following repo:
- [BatteryLife project](https://github.com/Ruifeng-Tan/BatteryLife)